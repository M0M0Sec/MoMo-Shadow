#!/bin/bash -e
#
# Install MoMo-Shadow
#

echo "Installing MoMo-Shadow..."

# Clone MoMo-Shadow
if [ ! -d /opt/shadow ]; then
    git clone https://github.com/M0M0Sec/MoMo-Shadow.git /opt/shadow
fi

# Create virtual environment
cd /opt/shadow
python3 -m venv venv
. venv/bin/activate
pip install --upgrade pip wheel setuptools
pip install -e . || echo "pip install failed, continuing..."

# Create directories (use momo-shadow to avoid conflict with /etc/shadow)
mkdir -p /etc/momo-shadow
mkdir -p /var/momo-shadow/data
mkdir -p /var/momo-shadow/captures

# Copy config
if [ -f /opt/shadow/config/shadow.example.yml ]; then
    cp /opt/shadow/config/shadow.example.yml /etc/momo-shadow/config.yml
fi

# Install systemd service
if [ -f /opt/shadow/deploy/shadow.service ]; then
    cp /opt/shadow/deploy/shadow.service /etc/systemd/system/
    systemctl enable shadow.service || true
fi

echo "MoMo-Shadow installed successfully!"

